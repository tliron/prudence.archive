<html>
<head>
	<title>Ruby Scriptlets Demo</title>
	<link rel="stylesheet" type="text/css" href="../../style/soft-cricket.css" />
</head>
<body>
<table width="100%"><tr valign="top"><td>
<%ruby

#
# Accessing the request
#

form = @prudence.resource.request.resource_ref.query_as_form

#
# Stream this page
#

if form.get_first_value('stream') == 'true'
	if @prudence.stream
		raise
	end
end

#
# Cache this page
#

@prudence.cache_duration = 5000
@prudence.cache_key = '{name}?{rq}' # Include query in cache key

#
# Calling Java
#

require 'java'
import java.lang.System
print '<p>This page was dynamically generated at ', System::current_time_millis, '</p>'

#
# Including a document
#
# This is identical to:
#
#   @prudence.include_document 'path'
#

%>
<%& '../fragments/test/jruby/' %>
<%

#
# An example of a method
#

def print_adapter adapter
%>
<p>
	<i>Adapter:</i> <%= adapter.attributes['name'] %> version <%= adapter.attributes['version'] %><br />
	<i>Language:</i> <%= adapter.attributes['language.name'] %> version <%= adapter.attributes['language.version'] %><br />
	<i>Tags:</i> 
<%
	tags = adapter.attributes['tags'].to_array
	for i in 0 .. tags.length - 1
		print tags[i]
		if i < tags.length - 1
			print ', '
		end
	end
%>
</p>
<%
end

%>
<h3>Language used:</h3>
<%
print_adapter @executable.context.adapter
%>
<h3>Available languages:</h3>
<%
adapters = @executable.context.manager.adapters.to_array
for adapter in adapters
	print_adapter adapter
end
%>
</td><td>
<h3>The "id" attribute in the URL query is:</h3>
<p><%= form.get_first_value('id') %></p>
<h3>A few tests:</h3>
<p>
<%
for i in 0 .. 9
%>
A multiple of three: 
<%
	print_triple i
%>
<br />
<%
end
%>
</p>
</td></tr></table>
</body>
<html>