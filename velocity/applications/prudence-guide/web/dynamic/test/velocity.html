<html>
<head>
	<title>Velocity Scriptlets Demo</title>
	<link rel="stylesheet" type="text/css" href="../../style/soft-cricket.css" />
</head>
<body>
<table width="100%"><tr valign="top"><td>
<%velocity

##
## Accessing the request
##

#set($form = $conversation.resource.request.resourceRef.queryAsForm)

##
## Stream this page
##

#if($form.getFirstValue('stream') == 'true')
	#if($conversation.stream())
		$prudence.kaboom()
	#end
#end

##
## Cache this page
##

#set($prudence.cacheDuration = 5000)

##
## Calling Java
##

%><%js

// Velocity is a templating language, not a full-blown scripting language. As such, it's missing some
// features we need! In this case, we want to call a static method. So, we'll just use this JavaScript
// scriptlet to fill in the gaps.

context.setAttribute('currentTimeMillis', String(java.lang.System.currentTimeMillis()), javax.script.ScriptContext.GLOBAL_SCOPE);
%><%velocity

<p>This page was dynamically generated at $currentTimeMillis</p>

##
## Including a document
##
## This is identical to:
##
##   $prudence.includeDocument('path')
##

%><%& "../fragments/test/velocity/" %><%

##
## An example of a macro
##

#macro(printAdapter $adapter)
	<p>
	<i>Adapter:</i> $adapter.attributes.get('name') version $adapter.attributes.get('version') <br />
	<i>Language:</i> $adapter.attributes.get('language.name') version $adapter.attributes.get('language.version') <br />
	<i>Tags:</i> 
	#set($size = $adapter.attributes.get('tags').size())
	#foreach($tag in $adapter.attributes.get('tags'))
		$tag#if($velocityCount < $size),#end
	#end
#end

<h3>Language used:</h3>
#printAdapter($executable.context.adapter)
<h3>Available languages:</h3>
#foreach($adapter in $executable.context.manager.adapters)
	#printAdapter($adapter)
#end
</td><td>
<h3>The "id" attribute in the URL query is:</h3>
<p>$!form.getFirstValue('id')</p>
<h3>A few tests:</h3>
<p>
#foreach($i in [0..9])
	A multiple of three:
	#printTriple($i)
	<br />
#end
</p>
%>
</td></tr></table>
</body>
<html>