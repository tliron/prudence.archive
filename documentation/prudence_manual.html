<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<meta name="generator" content="http://www.nongnu.org/elyxer/"/>
<meta name="create-date" content="2010-05-18"/>
<link rel="stylesheet" href="http://www.nongnu.org/elyxer/lyx.css" type="text/css" media="screen"/>
<title>The Prudence Manual</title>
</head>
<body>
<div id="globalWrapper">

<h1 class="title">
The Prudence Manual
</h1>
<h2 class="author">
Tal Liron
</h2>
<div class="Unindented">

<div class="fulltoc">

<div class="tocheader">
Table of Contents
</div><div class="tocindent">

<div class="toc">
<a class="Link" href="#toc-Section-1">Section: Tutorial</a>
</div><div class="tocindent">

<div class="toc">
<a class="Link" href="#toc-Subsection-1">Subsection: Run the Prudence Instance</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-2">Subsection: Your First Application</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-3">Subsection: A Static Web Page</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-4">Subsection: A Dynamic Web Page</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-5">Subsection: A Resource</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-6">Subsection: Advanced Routing</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-7">Subsection: Other Features</a>
</div></div>

<div class="toc">
<a class="Link" href="#toc-Section-2">Section: Instance Configuration</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Section-3">Section: Application Configuration</a>
</div><div class="tocindent">

<div class="toc">
<a class="Link" href="#toc-Subsection-8">Subsection: Settings </a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-9">Subsection: Routing</a>
</div></div>

<div class="toc">
<a class="Link" href="#toc-Section-4">Section: Resources </a>
</div>
<div class="toc">
<a class="Link" href="#toc-Section-5">Section: HTML Generation</a>
</div><div class="tocindent">

<div class="toc">
<a class="Link" href="#toc-Subsection-10">Subsection: Scriptlets </a>
</div></div>

<div class="toc">
<a class="Link" href="#toc-Section-6">Section: Static Web</a>
</div><div class="tocindent">

<div class="toc">
<a class="Link" href="#toc-Subsection-11">Subsection: CacheControlFilter </a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-12">Subsection: JavaScriptUnifyMinifyFilter </a>
</div></div>

<div class="toc">
<a class="Link" href="#toc-Section-7">Section: Debugging </a>
</div>
<div class="toc">
<a class="Link" href="#toc-Section-8">Section: API</a>
</div><div class="tocindent">

<div class="toc">
<a class="Link" href="#toc-Subsection-13">Subsection: application</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-14">Subsection: document</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-15">Subsection: executable</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-16">Subsection: conversation</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-17">Subsection: Routing</a>
</div></div>

<div class="toc">
<a class="Link" href="#toc-Section-9">Section: For Java Programmers</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Section-10">Section: How to Choose a Flavor?</a>
</div><div class="tocindent">

<div class="toc">
<a class="Link" href="#toc-Subsection-18">Subsection: Python (Succulent!)</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-19">Subsection: Ruby (Delectable!)</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-20">Subsection: Clojure (Scrumptious!)</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-21">Subsection: JavaScript (Savory!)</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-22">Subsection: PHP (Ambrosial!)</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-23">Subsection: Groovy (Luscious!)</a>
</div></div>

<div class="toc">
<a class="Link" href="#toc-Section-11">Section: The Case for REST</a>
</div><div class="tocindent">

<div class="toc">
<a class="Link" href="#toc-Subsection-24">Subsection: Resources</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-25">Subsection: Identifiers</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-26">Subsection: Delete</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-27">Subsection: Read</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-28">Subsection: Update</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-29">Subsection: Create</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-30">Subsection: Aggregate Resources</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-31">Subsection: Formats</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-32">Subsection: Shared State</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-33">Subsection: Summary of Features</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-34">Subsection: Let’s Do It!</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-35">Subsection: The Punchline</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-36">Subsection: It’s All About Infrastructure</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-37">Subsection: Does REST Scale?</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-38">Subsection: Prudence</a>
</div></div>

<div class="toc">
<a class="Link" href="#toc-Section-12">Section: Scaling Tips</a>
</div><div class="tocindent">

<div class="toc">
<a class="Link" href="#toc-Subsection-39">Subsection: Caching</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-40">Subsection: Necessary Tasks</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-41">Subsection: Deferrable Tasks</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-42">Subsection: Request Fragmentation</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-43">Subsection: Data Backends</a>
</div></div>

<div class="toc">
<a class="Link" href="#toc-Section-13">Section: Under the Hood</a>
</div><div class="tocindent">

<div class="toc">
<a class="Link" href="#toc-Subsection-44">Subsection: Restlet</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-45">Subsection: The JVM</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-46">Subsection: Jython, JRuby, Clojure, Rhino, Quercus, Groovy</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-47">Subsection: Scripturian</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-48">Subsection: Succinct</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-49">Subsection: Jygments</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-50">Subsection: H2</a>
</div></div>

<div class="toc">
<a class="Link" href="#toc-Section-14">Section: FAQ</a>
</div><div class="tocindent">

<div class="toc">
<a class="Link" href="#toc-Subsection-51">Subsection: REST</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-52">Subsection: Languages</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-53">Subsection: Concurrency</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-54">Subsection: Performance</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-55">Subsection: Scalability</a>
</div>
<div class="toc">
<a class="Link" href="#toc-Subsection-56">Subsection: Licensing</a>
</div></div>
</div>

</div>
</div>
<h1 class="Section">
<a class="toc" name="toc-Section-1"></a>Tutorial
</h1>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-1"></a>Run the Prudence Instance
</h2>
<div class="Unindented">
Prudence comes ready to rumble!
</div>
<div class="Indented">
All you need is a Java Virtual Machine (JVM), minimally version 5. Your operating system may already have one. Typing ‘‘java’’ from the command line will usually tell you so. Otherwise, an excellent, open-source JVM is available from the <a class="URL" href="http://openjdk.java.net/">OpenJDK</a> project.
</div>
<blockquote class="Quote">
A Java Runtime Environment (JRE) is enough for Prudence. You need a Java Development Kit (JDK) only if you plan to write code in Java. Also, Prudence does not require anything from Java Enterprise Edition (JEE). In fact, you can see Prudence as a RESTful, minimal alternative to developing web applications under JEE.
</blockquote>
<div class="Unindented">
Try Prudence! Run /bin/run.sh for Unix-like systems (Linux and OS X), or /bin/run.bat for Windows. Prudence should declare its version list the installed demo applications. When it announces that it is listening on port 8080, it’s ready to go. Open your web browser to <a class="URL" href="http://localhost:8080/">http://localhost:8080/</a>. You should see the Prudence Administration application, where you can access the demos. 
</div>
<blockquote class="Quote">
<i>By the way:</i> The /bin/run scripts are there for getting you quickly up and running, however it is strongly recommended that you run <a class="URL" href="../daemon/">Prudence as a daemon</a> in production environments.
</blockquote>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-2"></a>Your First Application
</h2>
<div class="Unindented">
Your Prudence instance hosts all applications under the /applications/ directory. To install a new application, simply create a new subdirectory there. The subdirectory name will be used as a default for various things: the base URL, logging, etc. We can change those later. 
</div>
<div class="Indented">
So, let’s create /applications/wackywiki/
</div>
<div class="Indented">
If you restart Prudence, you’ll see wackywiki listed in the admin application. There’s nothing to see there quite yet, though.
</div>
<blockquote class="Quote">
<i>By the way:</i> It’s perfectly fine to use symbolic links or mounts to put your application subdirectories elsewhere.
</blockquote>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-3"></a>A Static Web Page
</h2>
<div class="Unindented">
Create /applications/wackywiki/web/static/. Files you put there will served just like from any static web server. You can put images, HTML files, CSS or anything else. Let’s start with a default web page.
</div>
<div class="Indented">
/web/static/index.html:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;Wacky Wiki&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;div&gt;
		Nothing to see here, for now. Carry on.
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt; 
</code>
</div>
</div>
</div>
<div class="Indented">
Restart Prudence, and browse to <a class="URL" href=" http://localhost:8080/wackiwiki/">http://localhost:8080/wackiwiki/</a> to see the page. 
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-4"></a>A Dynamic Web Page
</h2>
<blockquote class="Quote">
Important! While Prudence does dynamic web pages well, it really stands out from other web frameworks in its support for REST resources, which we’ll see in the next section. We decided to start this tutorial with web pages, because the topic would likely be more familiar to most newcomers to Prudence.
</blockquote>
<div class="Unindented">
Create /applications/wackywiki/web/dynamic/. Unlike /web/static/, files in this directory must be text files (HTML, XML, plain text, etc.) They are specially processed so that they can include ‘‘scriptlets’’ of programming code. 
</div>
<div class="Indented">
Let’s move our index.html from /web/static/ to /web/dynamic/ and edit it to add some Python scriptlets. 
</div>
<div class="Indented">
/web/dynamic/index.html:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;Wacky Wiki&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;div&gt;
		It is currently
&lt;%python
from datetime import datetime
now = datetime.now()
print now.strftime(’%H:%M’)
%&gt;
		o’ clock, and
&lt;%
print now.strftime(’%S’)
%&gt;
		seconds
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code>
</div>
</div>
</div>
<div class="Indented">
Restart Prudence, and browse to <a class="URL" href=" http://localhost:8080/wackiwiki/">http://localhost:8080/wackiwiki/</a> to see the page. 
</div>
<div class="Indented">
You’ll notice the &lt;% and %&gt; are used to delimit scriptlets, and that we’ve added ‘‘python’’ to the opening delimiter of the first scriptlet. Subsequent scriptlets on the page will automatically use the language of the previous scriptlets, so we don’t have to repeat ‘‘python’’.
</div>
<div class="Indented">
Note, too, that Python’s ‘‘print’’ works by adding output to the stream of text where the scriptlet is located.
</div>
<div class="Indented">
Final note: Though they are conventionally called ‘‘scriptlets,’’ they are not ‘‘scripts’’ in the common meaning of interpreted code. All scriptlets are, in fact, compiled and run as JVM bytecode. That’s fast.
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-1"></a>Expressions
</h3>
<div class="Unindented">
Let’s make our dynamic page more readable by using special ‘‘expression scriptlets.’’ They’re really just a shorthand for ‘‘print.’’
</div>
<div class="Indented">
/web/dynamic/index.html:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;Wacky Wiki&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;div&gt;
&lt;%python
from datetime import datetime
now = datetime.now()
%&gt;
		It is currently &lt;%= now.strftime(’%H:%M’) %&gt; o’ clock, and &lt;%= now.strftime(’%S’) %&gt; seconds
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code>
</div>
</div>
</div>
<div class="Indented">
What happens if you have a coding error in your scriptlets? Let’s try and introduce an error on purpose.
</div>
<div class="Indented">
/web/dynamic/index.html:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">... from dratetime import datetime ...
</code>
</div>
</div>
</div>
<div class="Indented">
If you try to browse to the page, Prudence will show you a detailed debug page, from where you can also access the source code with the troublesome code line highlighted. Once you deploy your application, you can cancel this debug feature. Also, you can show your own, custom, user-friendly error pages. We’ll get to that below. 
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-2"></a>Fragments
</h3>
<div class="Unindented">
Prudence lets you include others documents in-place using a special scriptlet. This makes it very easy to reuse fragments of documents (which can include scriptlets) throughout your dynamic pages. Common reusbale fragments are page headers, footers, and navigation menus.
</div>
<div class="Indented">
By convention in Prudence, fragments are put in /web/fragments/, though you can include them from anywhere, even from your regular /web/dynamic/ or /web/static/ subdirectories. The advantage of keeping them out of those subdiretories is that users won’t be able to access the individual fragments directly. Instead, we must explicitly include them in our /web/dynamic/ files. 
</div>
<div class="Indented">
Let’s create a fragment that displays the current time.
</div>
<div class="Indented">
/web/fragments/time.html:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">&lt;%python
from datetime import datetime
now = datetime.now()
%&gt;
It is currently &lt;%= now.strftime(’%H:%M’) %&gt; o’ clock, and &lt;%= now.strftime(’%S’) %&gt; seconds
</code>
</div>
</div>
</div>
<div class="Indented">
/web/dynamic/index.html:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;Wacky Wiki&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;div&gt;
		&lt;%&amp; ’time/’ %&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code>
</div>
</div>
</div>
<div class="Indented">
Note that the included scriptlet, which begins with the &lt;%&amp; delimiter, accepts a real Python expression. For example, you can do Pythony things like string interpolation: &lt;%&amp; ’%s-%s’ % (language, encoding) %&gt;, allowing you to include different fragments according to changing circumstances. 
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-3"></a>Caching
</h3>
<div class="Unindented">
Dynamically generating HTML and other text is very powerful. You may be wondering, however, how well this scales. Even if the Python code is compiled, it would still need to be run for every user request, right? Prudence supports straightforward per-page caching to greatly help you scale. By changing document.cacheDuration within a scriptlet, you can dynamically change how long Prudence will look for updates in the document. Note that even very short caching times can be a great boost to scalability. For example, if your cache duration is 1 second, it means that your scriptlets would only be run once every second. In computing terms, that’s a very long time! Imagine that your popular web site is getting 1000 hits per second... 
</div>
<div class="Indented">
Finally, you’ll be happy to know that by default Prudence also enables client-side caching. It does this by setting a standard HTTP header that tells the client how long the content should be cached. All popular desktop and mobile web browsers recognize it. This means bandwidth savings for you, because the client will not download content it already has in its cache. 
</div>
<div class="Indented">
Let’s enable a simple 60 second cache.
</div>
<div class="Indented">
/web/dynamic/index.html:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">&lt;% document.cacheDuration = 60000 %&gt;
&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;Wacky Wiki&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;div&gt;
		&lt;%&amp; ’time/’ %&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code>
</div>
</div>
</div>
<div class="Indented">
To test the above, go to our page and keep refreshing it in your web browser. You will see that the printed time will only be updated once every 10 seconds.
</div>
<div class="Indented">
To verify that client-side caching works correctly, we recommend using the free Firefox browser with the <a class="URL" href="http://getfirebug.com/">Firebug</a> add-on. In the Firebug network panel, you can see which requests are sent to the server. Within those 60 seconds between updates, you will see the that the request for the page returns a 304 status code: ‘‘the document has not been modified.’’
</div>
<div class="Indented">
For an even more elaborate experiment, try running two browsers at the same time on different machines, and keep refreshing them. You’ll see each client caching individually, and yet the server still returning a different page only after the 60 second cache duration has passed. 
</div>
<div class="Indented">
Caching is very powerful, but obviously not useful for all pages. For example, if it’s important for a page to always show the up-to-date to the moment information, you might not be able to afford even a one second cache. It’s useful, then, to know that Prudence’s document.cacheDuration works at the level of the actual document, so that each included fragment can set its own cache duration. Just remember that the top document or fragment requests will determine the caching for included fragments, too. If your index.html has a cache duration of 60 seconds, then even if an included fragment has a cache duration of 1 second, it would only appear to update every 60 seconds. 
</div>
<div class="Indented">
Scriptlets can also dynamically change the cache duration according to changing circumstances. For example, under heavy load, you might want your application to cache for longer periods of time.
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-4"></a>HTML Forms
</h3>
<div class="Unindented">
TODO
</div>
<div class="Indented">
Let’s allow users to edit our wacky wicki. 
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">form = prudence.resource.request.resourceRef.queryAsForm
fresh = form.getFirstValue(’fresh’) == ’true’
</code>
</div>
</div>
</div>
<div class="Indented">
/web/fragments/wiki.html:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">&lt;%python
wiki = ’Nothing in the wiki yet.’
%&gt;
Wiki content is: &lt;%= wiki %&gt;
</code>
</div>
</div>
</div>
<div class="Indented">
/web/dynamic/index.html:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;Wacky Wiki&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;div&gt;
		&lt;%&amp; ’time/’ %&gt;
	&lt;/div&gt;
	&lt;div&gt;
		&lt;%&amp; ’wiki/’ %&gt;
	&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code>
</div>
</div>
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-5"></a>More HTTP
</h3>
<div class="Unindented">
Prudence does a lot of the HTTP work automatically, but you can manipulate the response yourself. For example, to redirect the client: 
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">prudence.resource.response.locationRef = prudence.resource.request.resourceRef.baseRef
prudence.statusCode = 303
raise
</code>
</div>
</div>
</div>
<blockquote class="Quote">
Note the use of "raise": it’s a handy trick to end processing of our page. Prudence recognizes that we explicitly changed the status code, so it doesn’t consider this to be a real error.
</blockquote>
<div class="Unindented">
You can use also prudence.statusCode to explicitly set an error, for example to send 403 (‘‘Forbidden’’) if the user is not logged in. 
</div>
<div class="Indented">
Need more HTTP? Prudence supports HTTP cookies and HTTP authentication challenges. We won’t get into that in this tutorial, though. 
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-6"></a>Templating
</h3>
<div class="Unindented">
You might wonder what other options are available to you other than ‘‘python’’ for scriptlets. You can choose other languages---Ruby, JavaScript, Clojure, PHP, etc.---if you have them installed. But, more importantly, you can choose to use one of the pre-included templating languages, Succint and Velocity.
</div>
<div class="Indented">
Templating languages have far less features than any of the above programming languages, but this can be an advantage if you all you need is simple templating. They tend to be more readable for templates. Best of all, you can mix scriptlets from various languages in one page. Here’s an example of using Velocity and Python: 
</div>
<div class="Indented">
/web/fragments/time.html:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">&lt;%python
from datetime import datetime
now = datetime.now()
clock = now.strftime(’%H:%M’)
seconds = now.strftime(’%S’)
%&gt;
&lt;%velocity It is currently $clock o’ clock, and $seconds seconds %&gt;
</code>
</div>
</div>
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-5"></a>A Resource
</h2>
<div class="Unindented">
As stated earlier, where Prudence truly shines is in its support for REST resources. A resource is a piece of data associated with a URL, which clients can optionally create, read, update or delete. An HTML web page is an example of a resource which is usually read, and sometimes supports writing (for handling HTML forms). Prudence lets you create resources that support one or more formats, all create/read/update/delete (CRUD) operations, and advanced caching. 
</div>
<div class="Indented">
A resource-oriented architecture is perfect for ‘‘AJAX’’ and other rich client platforms (Flash, Silverlight, etc.). Another use is for a scalable backend conduit between servers. Depending on how you look at it, resources are either an online database, an API for your service, or both. 
</div>
<blockquote class="Quote">
You might want to take a look at <a class="URL" href="../rest/">Making the Case for REST</a> for a better understanding of REST and what it can do for you.
</blockquote>
<div class="Unindented">
Let’s start with a resource that can be read for some plain text. Resources are put in the /resources/ subdirectory, and, like /web/dynamic/ and /web/static/, the filename and directory tree define the URL:
</div>
<div class="Indented">
/resources/wiki.py:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">def handle_init(conversation):
	conversation.addMediaTypeByName(’text/plain’)
def handle_get(conversation):
	return ’Nothing in the wiki yet.’
</code>
</div>
</div>
</div>
<div class="Indented">
handleInit() always gets called first, before any of the other handler functions. 
</div>
<div class="Indented">
Try browsing to <a class="URL" href=" http://localhost:8080/wackiwiki/wiki/">http://localhost:8080/wackiwiki/wiki/</a> to see your resource.
</div>
<div class="Indented">
Plain text is good for us humans to read. But, we might want to support formats that are more useful for client applications, such as <a class="URL" href="http://www.json.org/">JSON</a> for browser-based JavaScript or Flash’s ActiveScript. 
</div>
<div class="Indented">
Let’s add support for JSON to our resource:
</div>
<div class="Indented">
/resources/wiki.py:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">wiki = ’Nothing in the wiki yet.’
​
def handle_init(conversation):
	conversation.addMediaTypeByName(’text/plain’)
	conversation.addMediaTypeByName(’application/json’)
​
def handle_get(conversation):
	if conversation.mediaTypeByName == ’text/plain’:
		return wiki
	else:
		return ’{"content": "%s"}’ % wiki
</code>
</div>
</div>
</div>
<div class="Indented">
[Add jQuery to dynamic page to test in browser.]
</div>
<div class="Indented">
Just as /web/fragments/ was a useful place for us to put reusable web fragments, we can use /libraries/ for reusable code for resources, as well as dynamic web scriptlets. Let’s create a library to handle our wiki:
</div>
<div class="Indented">
/libraries/wiki.py:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">wiki = ’Nothing in the wiki yet.’
​
def get_wiki():
	return wikiwiki = ’Nothing in the wiki yet.’
​
def handle_init(conversation):
	conversation.addMediaTypeByName(’text/plain’)
	conversation.addMediaTypeByName(’application/json’)
​
def handle_get(conversation):
	if conversation.mediaTypeByName == ’text/plain’:
		return wiki
	else:
		return ’{"content": "%s"}’ % wiki
</code>
</div>
</div>
</div>
<div class="Indented">
Let’s make use of our library in our resource: 
</div>
<div class="Indented">
/resources/wiki.py:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">from wiki import get_wiki
​
def handle_init(conversation):
	conversation.addMediaTypeByName(’text/plain’)
	conversation.addMediaTypeByName(’application/json’)
​
def handle_get(conversation):
	if conversation.mediaTypeByName == ’text/plain’:
		return get_wiki()
	else:
		return ’{"content": "%s"}’ % get_wiki()
</code>
</div>
</div>
</div>
<div class="Indented">
[Put, Post, Delete.]
</div>
<div class="Indented">
/libraries/wiki.py:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">from threading import RLock
​
wiki = ’Nothing in the wiki yet.’
wiki_lock = RLock()
​
def get_wiki():
	wiki_lock.acquire()
	try:
		return wiki
	finally:
		wiki_lock.release()
​
def set_wiki(content):
	wiki_lock.acquire()
	try:
		wiki = content
	finally:
		wiki_lock.release()
</code>
</div>
</div>[Fixing our form handling from earlier using doPost.]
</div>
<div class="Indented">
Remember how we supported client-side caching for our dynamic web pages? We have much more control over this process in resources. We can set explicit modification dates and ETags. 
</div>
<div class="Indented">
Let’s give our wiki resources a modification date, so that clients can properly cache it:
</div>
<div class="Indented">
/libraries/wiki.py:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">from threading import RLock
from datetime import datetime
​
def to_milliseconds(dt):
	return long(mktime(dt.timetuple()) * 1000)
	wiki = {content: ’Nothing in the wiki yet.’, timestamp: datetime.now()}
	wiki_lock = RLock()
​
def get_wiki():
	wiki_lock.acquire()
	try:
		# Note that we are returning a copy of our wiki dictionary!
		return {content: wiki[’content’], timestamp: wiki[’timestamp’]}
	finally:
		wiki_lock.release()
​
def set_wiki(content):
	wiki_lock.acquire()
	try:
		wiki[’content’] = content
		wiki[’timestamp’] = datetime.now()
	finally:
		wiki_lock.release()
</code>
</div>
</div>
</div>
<div class="Indented">
/resources/wiki.py:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">from wiki import get_wiki, set_wiki, to_milliseconds
​
def handle_init(conversation):
	conversation.addMediaTypeByName(’text/plain’)
	conversation.addMediaTypeByName(’application/json’)
​
def handle_get(conversation):
	wiki = get_wiki()
	conversation.modificationTimestamp = to_milliseconds(wiki[’timestamp’])
	if conversation.mediaTypeByName == ’text/plain’:
		return wiki[’content’]
	else:
		return ’{"content": "%s"}’ % wiki[’content’]
</code>
</div>
</div>
</div>
<div class="Indented">
Support for modification date can go a long way towards saving us bandwidth. However, note that we still have to fetch the entire wiki in order to get its modification date. This could potentially be a costly operation, say, if the wiki is stored in a database. 
</div>
<div class="Indented">
Prudence lets you optimize this by letting you check only the modification date (or ETag) before actually fetching the resource. 
</div>
<div class="Indented">
Let’s add handleGetInfo():
</div>
<div class="Indented">
/resources/wiki.py:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">from wiki import get_wiki, set_wiki, to_milliseconds
​
def handle_init(conversation):
	conversation.addMediaTypeByName(’text/plain’)
	conversation.addMediaTypeByName(’application/json’)
​
def handle_get(conversation):
	wiki = get_wiki()
	conversation.modificationTimestamp = to_milliseconds(wiki[’timestamp’])
	if conversation.mediaTypeByName == ’text/plain’:
		return wiki[’content’]
	else:
		return ’{"content": "%s"}’ % wiki[’content’]
​
def handle_get_info(conversation):
	wiki = get_wiki()
	return to_milliseconds(wiki[’timestamp’])
</code>
</div>
</div>
</div>
<div class="Indented">
Our trivial example didn’t offer any significant savings. But, suppose our resource involved fetching lots of wiki pages at once? We could save computing power if you we only had to fetch a modification date. 
</div>
<div class="Indented">
As we said earlier, our resources can be seen as an API. Indeed, there’s no reason to maintain two sets of APIs, one for ‘‘the world’’ to access via your resources, and one for your application to use internally. You can use easily use your resources internally: 
</div>
<div class="Indented">
/fragments/wiki.html:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">&lt;%python
wiki = document.internal(’wiki’, ’application/json’)
wiki = eval(’(’ + wiki.text + ’)’)
%&gt;
Wiki content is: &lt;%= wiki[’content’] %&gt;
</code>
</div>
</div>
</div>
<div class="Indented">
The above is wasteful because we are turning the wiki data into JSON and then back again. For internal API uses, it’s possible to support direct access to the object: 
</div>
<div class="Indented">
[ObjectRepresentation]
</div>
<div class="Indented">
For completion, here’s an example of how to access our resources from another Prudence-based application:
</div>
<div class="Indented">
/fragments/wiki.html:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">&lt;%python
wiki = document.external(’http://192.168.1.2/wackywiki/wiki’, ’application/json’)
wiki = eval(’(’ + wiki.text + ’)’)
%&gt;
Wiki content is: &lt;%= wiki[’content’] %&gt;
</code>
</div>
</div>
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-6"></a>Advanced Routing
</h2>
<div class="Unindented">
Capturing URL patterns.
</div>
<div class="Indented">
Improve our resource above over the query params.
</div>
<blockquote class="Quote">
<i>By the way:</i> Difference between URL and URI.
</blockquote>
<div class="Unindented">
Virtual hosting, multiple servers.
</div>
<div class="Indented">
Status handlers---custom 404.
</div>
<div class="Indented">
Just for fun: robots.txt, sitemap.xml.
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-7"></a>Other Features
</h2>
<div class="Unindented">
Logging.
</div>
<div class="Indented">
Debug page.
</div>
<div class="Indented">
Defrosting and pre-heating.
</div>
<div class="Indented">
SSL.
</div>
<div class="Indented">
Advanced representations. (Restlet extensions.)
</div>
<h1 class="Section">
<a class="toc" name="toc-Section-2"></a>Instance Configuration
</h1>
<h1 class="Section">
<a class="toc" name="toc-Section-3"></a>Application Configuration
</h1>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-8"></a>Settings 
</h2>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-9"></a>Routing
</h2>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-7"></a>URI templates
</h3>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-8"></a>Attaching 
</h3>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-9"></a>Redirecting 
</h3>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-10"></a>Capturing 
</h3>
<h1 class="Section">
<a class="toc" name="toc-Section-4"></a>Resources 
</h1>
<h1 class="Section">
<a class="toc" name="toc-Section-5"></a>HTML Generation
</h1>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-10"></a>Scriptlets 
</h2>
<h1 class="Section">
<a class="toc" name="toc-Section-6"></a>Static Web
</h1>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-11"></a>CacheControlFilter 
</h2>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-12"></a>JavaScriptUnifyMinifyFilter 
</h2>
<h1 class="Section">
<a class="toc" name="toc-Section-7"></a>Debugging 
</h1>
<h1 class="Section">
<a class="toc" name="toc-Section-8"></a>API
</h1>
<div class="Unindented">
Prudence exposes its API as services to your source code, whether its in scriptlets in /web/dynamic/, complete source code in /resources/, or your configuration scripts.
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-13"></a>application
</h2>
<div class="Unindented">
The same ‘‘application’’ service is shared between all code in a single application. Note this there is a single application instance per component, even if the application is routed on several virtual hosts and servers. The ‘‘application’’ service is a good place to store shared state for the application.
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-1"></a>application.globals, getGlobal, setGlobal
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-2"></a>application.arguments (for configuration scripts)
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-3"></a>application.application
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-4"></a>application.logger
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-5"></a>application.getMediaType
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-14"></a>document
</h2>
<div class="Unindented">
The ‘‘document’’ service has two distinct uses: first, it represents the file you are in: <i>this</i> document. This is where you can access the document’s attributes and possibly change them. The second use of this service is for accessing <i>other</i> documents. Prudence combines these two uses into one service, but they functionally separate.
</div>
<div class="Indented">
In the case of /resources/ and the configuration scripts, ‘‘this document’’ is simply the source code file. In the case /web/dynamic/, it’s the whole ‘‘text-with-scriptlets’’ page, so it is shared by all scriptlets on the page, even if they are written in different languages.
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-11"></a><i>This</i> document:
</h3>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-6"></a>document.source
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-7"></a>document.source.basePath
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-8"></a>document.cache
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-9"></a>document.cache.invalidate
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-10"></a>document.cacheKey
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-11"></a>document.cacheDuration
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-12"></a>document.cacheGroups
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-12"></a><i>Other</i> documents:
</h3>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-13"></a>document.include (/web/dynamic/)
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-14"></a>document.defaultLanguageTag (for include in startup scripts)
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-15"></a>document.internal
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-16"></a>document.external
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-15"></a>executable
</h2>
<div class="Unindented">
The ‘‘executable’’ is the low-level equivalent of ‘‘this document’’ (see above). Here you can explore which languages are installed in your Prudence instance, and gain access to their implementation mechanism. You’ll likely never need to do any of this in your Prudence application. For more information on executables, see Scripturian, the library that handles code execution for Prudence.
</div>
<div class="Indented">
A feature that you might want to use here is the executable globals. These are similar to the application globals (see above), except that they are global to the entire Prudence instance (in fact, to the virtual machine). It’s a good place to store state that you want shared between Prudence applications.
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-17"></a>executable.context
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-18"></a>executable.context.writer
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-19"></a>executable.context.attributes
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-20"></a>executable.context.exposedVariables
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-21"></a>executable.manager
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-22"></a>executable.container = the document!
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-23"></a>executable.globals, getGlobal, setGlobal
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-16"></a>conversation
</h2>
<div class="Unindented">
The ‘‘conversation’’ represents the request received from the user. This includes your response to the request, hence it’s a ‘‘conversation.’’ Here you can access various aspects of the request: the URI, formatting preferences, client information, and actual data sent with the request (the ‘‘entity’’). You can likewise set response characteristics.
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-24"></a>conversation.resource
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-25"></a>conversation.resource.request
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-26"></a>conversation.resource.request.resourceRef
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-27"></a>conversation.resource.response
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-28"></a>conversation.form, formAll
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-29"></a>conversation.uriValues
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-30"></a>conversation.characterSet Name, Extension
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-31"></a>conversation.language Name, Extension
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-32"></a>conversation.mediaType Name, Extension
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-33"></a>conversation.expirationDate/Timestamp
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-34"></a>conversation.modificationDate/Timestamp
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-35"></a>conversation.tag httpTag
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-36"></a>conversation.maxAge
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-37"></a>conversation.statusCode
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-38"></a>conversation.variant
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-39"></a>conversation.entity
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-40"></a>conversation.internal?
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-41"></a>conversation.addMediaType ByName, ByExtension
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-42"></a>conversation.streaming? (/web/dynamic/)
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-43"></a>conversation.stream (/web/dynamic/)
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-44"></a>conversation.yield
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-45"></a>conversation.locals
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-46"></a>conversation.kaboom
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-17"></a>Routing
</h2>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-47"></a>router.redirect
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-48"></a>router.capture
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-49"></a>statusService.capture
</div>
<h1 class="Section">
<a class="toc" name="toc-Section-9"></a>For Java Programmers
</h1>
<div class="Unindented">
Prudence brings the power of REST and the JVM to programmers in other languages, but has a lot to offer to Java/Restlet developers.
</div>
<div class="Indented">
A 100% Restlet-based alternative to servlet/JEE containers. (Requires only Restlet SE.)
</div>
<ol>

<li>
Easy deployment
<ol>

<li>
Boot scripts: avoid weird configuration formats and start your Restlet component exactly as you want (in your choice of scripting language) 
</li>
<li>
Default scripts already handle things like virtual hosting, multiple servers and internal routing 
</li>
<li>
Designed from the ground-up to handle multiple apps on the same component 
</li>
<li>
Admin app for realtime management of server(s) 
</li>
<li>
Logging is pre-configured and ‘‘just works,’’ including Apache-compatible web log 
</li>
<li>
Single-file ‘‘plop’’ deployment (like WAR files) 
</li>
</ol>
</li>
<li>
Easy prototyping of REST resources
<ol>

<li>
In the language of your choice 
</li>
<li>
Code is compiled, cached and loaded on-the-fly 
</li>
<li>
Rich debug page for runtime errors 
</li>
<li>
When you’re happy with it, you can rewrite it as a ServerResource in Java 
</li>
</ol>
</li>
<li>
Powerful HTML generation platform, like JSP/ASP/PHP (again, 100% Restlet-based)
<ol>

<li>
In the language of your choice, including mixing languages and template engines (Velocity, Succinct) on one page 
</li>
<li>
Code is compiled, cached and loaded on-the-fly 
</li>
<li>
RAM/db server-side caching (uses Restlet’s URI template language for cache key generation) 
</li>
<li>
Straightforward support for client-side caching 
</li>
<li>
Easily ‘‘stream’’ output (Restlet async) 
</li>
<li>
Easily accept uploaded files 
</li>
<li>
Rich debug page for runtime errors 
</li>
</ol>
</li>
<li>
Restlet sugar 
</li>
</ol>
<div class="Unindented">
Prudence comes with classes to Restlet tasks. You are free to use them without the Prudence platform. (They are available as a standalone jar.)
</div>
<ol>

<li>
Fallback router - Attach multiple MODE_STARTS_WITH restlets to the same base URI. 
<ol>

<li>
URI ‘‘capturing’’ (internal redirection) - Let the URI-space you expose to the world be different from the one you use internally. 
</li>
<li>
JavaScript unify-and-minify filter - Improve performance on web browsers. 
</li>
<li>
Delegated status service for displaying custom pages for error codes (404, 500, etc.) - They can be dynamically generated with Prudence ‘‘text-with-scriptlets.’’ 
</li>
<li>
Rich debug representation 
</li>
<li>
Caching system designed for StringRepresentations 
</li>
<li>
Easy file uploads - Slightly higher-level than the Restlet FileUpload extension. 
</li>
<li>
Also check out Scripturian and Jygments, Prudence’s sister libraries 
</li>
</ol>
</li>
</ol>
<h1 class="Section">
<a class="toc" name="toc-Section-10"></a>How to Choose a Flavor?
</h1>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-18"></a>Python (Succulent!)
</h2>
<div class="Unindented">
<a class="URL" href="http://www.python.org/">Python</a> is a powerful object-oriented language, far richer in features than JavaScript and PHP, with many high-quality core and 3rd party libraries. Python has already proven itself as a web programming language with many excellent platforms.
</div>
<div class="Indented">
Python presents a unique challenge in a scriptlet environment, due to its reliance on indentation. However, because HTML is loose with whitespace, it’s possible to force the whole file to adhere to Python’s scheme. In fact, as many Python enthusiasts would argue, forcing your code to adhere to Python’s indentation requirements can go a long way towards making it more readable and manageable.
</div>
<div class="Indented">
In the included example application we show how to use <a class="URL" href="http://www.sqlalchemy.org/">SQLAlchemy</a> as a data backend for Prudence.
</div>
<blockquote class="Quote">
Note: Prudence Python was built primarily around <a class="URL" href="http://www.jython.org/">Jython</a>, but also offers limited support for <a class="URL" href="http://jepp.sourceforge.net/">Jepp</a> if it’s installed. For those cases where you need access to a natively built Python library that won’t work on Jython, Jepp lets you run code on the CPython platform.
</blockquote>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-19"></a>Ruby (Delectable!)
</h2>
<div class="Unindented">
<a class="URL" href="http://www.ruby-lang.org/">Ruby</a> can do most of what Python can do and more. A true chameleon, it can adapt to many styles of code and programming. If something can be possible, Ruby allows it and supports it. Unlike Python, it has a very loose and forgiving syntax, which is perfect for scriptlets.
</div>
<div class="Indented">
Ruby’s <a class="URL" href="http://rubyonrails.org/">Rails</a> platform has revolutionized web programming by offering elegant, powerful alternatives to working directly with HTTP. We hope Ruby web programmers will find in Prudence a refreshing alternative to Rails: elegantly embracing HTTP, instead of avoiding it.
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-20"></a>Clojure (Scrumptious!)
</h2>
<div class="Unindented">
Prudence’s only functional flavor is a Lisp designed from the ground up for high concurrency. If you’re serious about scaling, <a class="URL" href="http://clojure.org/">Clojure</a> is the way to go. Though new, Clojure is based on one of the oldest programming languages around, and enjoys a rich tradition of elegant solutions for tough programming challenges.
</div>
<div class="Indented">
Clojure embraces the JVM, but also has a growing collection of nifty ‘‘contrib’’ libraries---all included in Prudence. In the included example application, we show how to use Clojure’s SQL library to access a data backend the Clojure way.
</div>
<div class="Indented">
Three Crickets ♥ Clojure. 
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-21"></a>JavaScript (Savory!)
</h2>
<div class="Unindented">
<a class="URL" href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> (a dialect of <a class="URL" href="http://www.ecmascript.org/">ECMAScript</a>) is a sensible choice for ‘‘AJAX’’ and other rich web client applications, because it’s the same language used by web browsers and other client platforms. Web developers are already proficient in JavaScript, and can quickly be brought on board to a server-side project. JavaScript lets you to write server-side and client-side code in the same language, and have both sides share code. Couple it with <a class="URL" href="http://www.json.org/">JSON</a>, and you’re on solid ground for rapid development. Of all the web programming languages, it’s the one most widely deployed and with the most secure future.
</div>
<div class="Indented">
JavaScript is an under-appreciated language. Though not as feature-rich as Python or Ruby, it’s still very powerful. Its straightforward closure/prototype mechanisms allow it to support object-orientation, namespaces and other paradigms. It’s also been the target of much un-deserved angst due to the fickleness of in-browser development. Working with the DOM, cross-browser HTML rendering quirks---none of these are the faults of the language itself, and none of these are relevant to server-side development with Prudence.
</div>
<div class="Indented">
JavaScript does not have its own core libraries, making it the most minimal Prudence flavor. But this isn’t necessarily a deficiency: instead, it uses the excellent JVM core.
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-22"></a>PHP (Ambrosial!)
</h2>
<div class="Unindented">
<a class="URL" href="http://www.php.net/">PHP</a>is, of course, ubiquitous. It’s a simple language with the most mature libraries of any web programming language, and programmers are available with years of experience. It’s also designed from the ground up as a programming language for the web.
</div>
<div class="Indented">
Prudence allows a smooth transition from traditional PHP HTML generation to REST resources. It supports PHP "superglobals" such as $_GET, $_POST, $_COOKIE and $_FILE (but not $_SESSION) to make you feel right at home. It also adds many new features to conventional HTML generation: fine-grained caching, high-performance templating languages, and more.
</div>
<blockquote class="Quote">
Note: Prudence PHP was built around the open source edition of <a class="URL" href="http://quercus.caucho.com/Quercus">Quercus</a>, which does not feature JVM bytecode compilation as is available in the non-free professional edition. Nevertheless, we found it an excellent performer!
</blockquote>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-23"></a>Groovy (Luscious!)
</h2>
<div class="Unindented">
In some ways, <a class="URL" href="http://groovy.codehaus.org/">Groovy</a> is the best of this bunch. It has all the flexibility of Ruby, but is designed from the ground up to enhance and extend Java. Java programmers would immediately feel at home, while gaining access to far less restrictive programming paradigms. Groovy makes Java... groovy.
</div>
<div class="Indented">
If you know your project will require a lot of interaction with Java libraries, Groovy is a terrific---and fun!---choice. (Note that other Prudence flavors also offer JVM interaction, but Groovy does it best.) 
</div>
<h1 class="Section">
<a class="toc" name="toc-Section-11"></a>The Case for REST
</h1>
<div class="Unindented">
There’s a lot of buzz about REST, but also a lot confusion about what it is and what it’s good for. The essay attempts to convey its simple essence.
</div>
<div class="Indented">
Let’s start, then, not at REST, but at an attempt to create a new architecture for building scalabale applications. Our goals are for it to be minimal, straightforward, and still have enough features to be productive. We want to learn some lessons from the failures of other, more elaborate and ‘‘complete’’ architectures.
</div>
<div class="Indented">
Let’s call ours a ‘‘resource-oriented architecture.’’
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-24"></a>Resources
</h2>
<div class="Unindented">
Our base unit is a ‘‘resource,’’ which, like an object in object-oriented architectures, encapsulates data with some functionality. However, we’ve learned from object-orientation that implementing arbitrary interfaces is a recipe for enormous complexity. Instead, then, we’ll keep it simple and define a limited interface that would still be useful enough.
</div>
<div class="Indented">
From our experience with relational databases, we’ve learned that a tremendous amount of power can be found in ‘‘CRUD’’: Create, Read, Update and Delete. If we support just these operations, our resources will already be very powerful, enjoying the accumulated wisdom and design patterns from the database world. 
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-25"></a>Identifiers
</h2>
<div class="Unindented">
First, let’s start with a way of discriminating our resources. We’ll define a name-based address space where our resources live. Each resource is ‘‘attached’’ to one or more addresses. We’ll allow for ‘‘/’’ as a customary separator to allow for hierarchical addressing schemes. For example:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">/animal/cat/12/image
/animal/cat/12/image/large
/animal/cat/12/specs
</code>
</div>
</div>
</div>
<div class="Indented">
In the above, we’ve allowed for different kinds of animals, a way of referencing individual animals, and a way of referencing specific aspects of these animals. Let’s now go over CRUD operations in order of complexity.
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-26"></a>Delete
</h2>
<div class="Unindented">
‘‘Delete’’ is the most trivial operation. After sending ‘‘delete’’ to an identifier, we expect it to not exist anymore. Whether or not sub-resources in our hierarchy can exist or not, we’d leave up to individual implementations. For example, deleting ‘‘/animal/cat/12/image’’ may or may not delete ‘‘/animal/cat/12/image/large’’.
</div>
<div class="Indented">
Note that we don’t care about atomicity here, because we don’t expect anything after our ‘‘delete’’ operation. A million changes can happen to our cat before our command is processed, but they’re all forgotten after ‘‘delete.’’ (See ‘‘update,’’ below, for a small caveat.)
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-27"></a>Read
</h2>
<div class="Unindented">
‘‘Read’’ is a bit more complicated than ‘‘delete.’’ Since we expect our resource to change, we want to make sure that there’s some kind of way to mark which version we are reading. This will allow us to avoid unnecessary reads if there hasn’t been any change.
</div>
<div class="Indented">
We’ll need our resource-oriented architecture to support some kind of version tagging feature.
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-28"></a>Update
</h2>
<div class="Unindented">
The problem with ‘‘update’’ is that it always references a certain version that we have ‘‘read’’ before. In some cases, though not all, we need some way to make sure that the data we expect to be there hasn’t changed since we’ve last ‘‘read’’ it. Let’s call this a ‘‘conditional update.’’
</div>
<div class="Indented">
Actually, we’ve oversimplified our earlier definition of ‘‘delete.’’ In some cases, we’d want a ‘‘conditional delete’’ to depend on certain expectations about the data. We might not want the resource deleted in some cases.
</div>
<div class="Indented">
We’ll need our resource-oriented architecture to support a ‘‘conditional’’ feature. 
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-29"></a>Create
</h2>
<div class="Unindented">
This is our most complex operation. Our first problem is that our identifier might not exist yet. One approach could be to try identifiers in sequence:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">Create: /animal/cat/13 -&gt; Error, already exists
Create: /animal/cat/14 -&gt; Error, already exists
Create: /animal/cat/15 -&gt; Error, already exists
...
Create: /animal/cat/302041 -&gt; Success!
</code>
</div>
</div>
</div>
<div class="Indented">
Obviously, this is not a scalable solution. Another approach could be to have a helper resource which provides us with the necessary ID:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">Read: /animal/cat/next -&gt; 14
Create: /animal/cat/14 -&gt; Oops, someone else beat us to 14!
Read: /animal/cat/next -&gt; 15
Create: /animal/cat/15 -&gt; Success!
</code>
</div>
</div>
</div>
<div class="Indented">
Of course, we can also have ‘‘/animal/cat/next’’ return IDs that are never used and avoid duplications. If we never create our cat, they will be wasted, though. The main problem with this approach is that it requires two calls per creation: a ‘‘read,’’ and then a ‘‘create.’’ We can handle this in one call by allowing for ‘‘partial’’ creation:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">Create: /animal/cat -&gt; We send the data for the cat without the ID, and get back the ID
</code>
</div>
</div>
</div>
<div class="Indented">
Other solutions exist, too. The point of this discussion is to show you that ‘‘create’’ is not trivial, but also that solutions to ‘‘create’’ exist within the resource-oriented architecture we’ve defined. ‘‘Create,’’ though complex, does not demand any new features. 
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-30"></a>Aggregate Resources
</h2>
<div class="Unindented">
At first glance, handling the problem of getting lots of resources at the same time, thus saving on the number of calls, can trivially be handled by the features we’ve listed so far. A common solution is to define a ‘‘plural’’ version of the ‘‘singular’’ resource:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">/animal/cats
</code>
</div>
</div>
</div>
<div class="Indented">
A ‘‘read’’ would give us all cats. But what if there are ten million cats? We can support paging. Again, we have a solution within our current feature set, using identifiers for each subset of cats:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">/animal/cats/100/200
</code>
</div>
</div>
</div>
<div class="Indented">
The above would return no more than 100 cats: from the 100th, to the 200th. There’s a slight problem in this solution: the burden is on whatever component in our system handles mapping identifiers to resources. This is not terrible, but if we want our system to be more generic, it could help if things like ‘‘100 to 200’’ could be handled by our resource more directly. For this convenience, let’s implement a simple parameter system for all commands:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">Read(100, 200): /animal/cats
</code>
</div>
</div>
</div>
<div class="Indented">
In the above, our mapping component only needs to know ‘‘/animal/cats’’. It can be very dumb, and easy to implement. 
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-31"></a>Formats
</h2>
<div class="Unindented">
The problem of supporting multiple formats seems similar, at first glance, to that of aggregate resources. Again, we could potentially solve it with command parameters:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">Read(UTF-8, Russian): /animal/cat/13
</code>
</div>
</div>
</div>
<div class="Indented">
This would give us a Russian, Unicode UTF-8 encoded version of our cat. Looks good, except that there is a potential problem. The client might prefer certain formats, but actually be able to handle others. We would not want a series of wasteful operations to happen until one succeeds. Of course, we can have another resource where all available formats are listed, but this would require an extra call, and also introduce the problem of atomicity. A better solution would be to have the client associate certain preferences per command, have our resource emit its capabilities, with mapping component in between ‘‘negotiating’’ these two lists, via a simple algorithm, and choose the best mutually preferable format.
</div>
<div class="Indented">
This would be a simple feature to add to our resource-oriented architecture, which could greatly help to decouple its support for multiple formats from its addressing scheme. 
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-32"></a>Shared State
</h2>
<div class="Unindented">
Shared state between the client and server is very useful for managing sessions, and implementing basic security. Of course, it’s quite easy to abuse shared state, too, by treating it as a cache for data. We don’t want to encourage that. Instead, we just want a very simple shared state system.
</div>
<div class="Indented">
We’ll allow for this by attaching small, named, shared state objects to every request and response to a command. Nothing fancy or elaborate. There is a potential security breach here, so we have to trust that all components along the way honor the relationship between client and server, and don’t allow other servers access to our shared state. 
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-33"></a>Summary of Features
</h2>
<div class="Unindented">
So, what do we need?
</div>
<div class="Indented">
We need a way to map identifiers to resources. We need support for the four CRUD operations. We need support for "conditional" updates and deletes. We need all operations to support ‘‘parameters.’’ We need ‘‘negotiation’’ of formats. And, we need a simple shared state attachment feature.
</div>
<div class="Indented">
This list is very easy to implement. It requires very little computing power, and no support for generic, arbitrary additions.
</div>
<div class="Indented">
Before we go on, it’s worth mentioning one important feature which we did not require: transactions. Transactions are optional, and sometimes core features in many databases and distributed object systems. They can be extremely powerful, as they allow atomicity across an arbitrary number of commands. They are also, however, heavy to implement, as they require considerable shared state between client and server. Powerful as they are, it is possible to live without them. It’s possible, for example, to implement this atomicity within a single resource. This would require us to define special resources per type of transaction which we want to support, but it does remove the heavy burden of supporting arbitrary transactions from our architecture. With some small reluctance, then, we’ll do without transactions. 
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-34"></a>Let’s Do It!
</h2>
<div class="Unindented">
OK, so now we know what we need, let’s go ahead and implement the infrastructure of components to handle our requirements. All we need is stacks for all supported clients, backend stacks for all our potential server platforms, middleware components to handle all the identifier routing, content negotiation, caching of data...
</div>
<div class="Indented">
...And thousands of man hours to develop, test, deploy, and integrate. Like any large-scale, enterprise architecture, even trivial requirements have to jump through the usual hoops set up by the sheer scale of the task. Behind every great architecture are the nuts and bolts of the infrastructure.
</div>
<div class="Indented">
Wouldn’t it be great if the infrastructure already existed?
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-35"></a>The Punchline
</h2>
<div class="Unindented">
Well, duh. All the requirements for our resource-oriented architecture are already supported by HTTP:
</div>
<div class="Indented">
Our resource identifiers are simple URLs. The CRUD operations are in the four HTTP verbs: PUT, GET, POST and DELETE. ‘‘Conditional’’ and ‘‘negotiated’’ modes are handled by headers, as are ‘‘cookies’’ for shared state. Version stamps are e-tags. Command parameters are query matrixes appended to URLs. It’s all there.
</div>
<div class="Indented">
Most importantly, the infrastructure for HTTP is already fully deployed world-wide. TCP/IP stacks are part of practically every operating system; wiring, switching and routing are part and parcel; HTTP gateways, firewalls, load balancers, proxies, caches, filters, etc., are stable consumer components; certificate authorities, national laws, international agreements are already in place to support the complex inter-business interaction. Importantly, this infrastructure is successfully maintained, with minimal down-time, by highly-skilled independent technicians, organizations and component vendors across the world.
</div>
<div class="Indented">
It’s important to note a dependency and possible limitation of HTTP: it is bound to TCP/IP. Indeed, all identifiers are URLs: Uniform Resource Locators. In URLs, the first segment is reserved for the domain, either an IP address or a domain name translatable to an IP address. Compare this with the more general URIs (Uniform Resource Identifiers), which do not have this requirement. Though we’ll often be tied to HTTP in REST, you’ll see the literature attempting, at least, to be more generic. There are definitely use cases for non-HTTP, and even non-TCP/IP addressing schemes. In Prudence, you’ll see that it’s possible to <a class="URL" href="http://localhost:8080/prudence-guide/rest/guide/resources">address internal resources with non-URL kinds of URIs</a>. 
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-36"></a>It’s All About Infrastructure
</h2>
<div class="Unindented">
The most important lesson to take from this experience is the importance of infrastructure. This is why, I believe, Roy Fielding named <a class="URL" href="http://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm">Chapter 5 of his 2000 dissertation</a> ‘‘Representational State Transfer’’ rather than, say, ‘‘resource-oriented architecture,’’ as we have here. Fielding, one of the authors of the HTTP protocol, was intimately familiar with its challenges, and the name is intended to point out the key characteristic of its infrastructure: it’s all about the transfer of lightly annotated data representations. "Resources" are merely logical encapsulations of these representations, depending on a contract between client and server. The infrastructure does not, in itself, do anything in particular to maintain, say, a sensible hierarchy of addresses, the atomicity of CRUD operations, etc. That’s up to your implementation. But, representational state transfer---REST---is the mundane, underlying magic that makes it all possible.
</div>
<div class="Indented">
To put it succinctly, a resource-oriented architecture requires a REST infrastructure. Practically, the two terms become interchangeable.
</div>
<div class="Indented">
The principles of resource-orientation can and are applied in many systems. The word wide web, of course, with its ecology of web browsers, web servers, certificate authorities, etc., is the most obvious model. But other core internet systems, such as email (SMTP, POP, IMAP), file transfer (FTP, WebDAV) also implement some subset of REST. Your application can do this, too, and enjoy the same potential for scalability as the above. 
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-37"></a>Does REST Scale?
</h2>
<div class="Unindented">
Part of the buzz about REST is that it’s an inherently scalable architecture. This is true, but perhaps not in the way that you think.
</div>
<div class="Indented">
Consider that there are two uses of the term ‘‘scalable’’:
</div>
<div class="Indented">
First, it’s the ability to respond to a growing number of user requests without degradation in response time, by ‘‘simply’’ adding hardware. This is the aspect of scalability that engineers care about. The simple answer is that REST can help, but it doesn’t stand out. SOAP can also do it pretty well. REST aficionados sometimes point out that REST is ‘‘stateless,’’ or ‘‘session-less,’’ both characteristics that would definitely help scale. But, this is misleading. Protocols might be stateless, but architectures built on top of them don’t have to be. For example, we’ve specifically talked about sessions here. And, you can easily make poorly scalable REST. The bottom line is that there’s nothing in REST that guarantees scalability in <i>this</i> respect. Indeed, engineers coming to REST due to this false lure end up wondering what the big deal is.
</div>
<div class="Indented">
The second use of ‘‘scalability’’ comes from the realm of enterprise and project management. It’s the ability of your project to grow in complexity without degradation in your ability to manage it. And that’s REST’s beauty---you already have the infrastructure, which is the hardest thing to scale in a project. You don’t need to deploy client stacks. You don’t need to create and update proxy objects for five different programming languages used in your enterprise. You don’t need to deploy incompatible middleware by three different vendors and spend weeks trying to force them to play well together. Why would engineers care about REST? Precisely because they don’t have to: they can focus on engineering, rather than get bogged down by infrastructure management.
</div>
<div class="Indented">
That said, a ‘‘resource-oriented architecture’’ as we defined here is not a bad start for (engineering-wise) scalable systems. Keep your extras lightweight, minimize or eliminate shared state, and encapsulate your resources according to use cases, and you won’t, at least, create any obstacles to scaling. 
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-38"></a>Prudence
</h2>
<div class="Unindented">
Convinced? The best way to understand REST is to experiment with it. You’ve come to the right place. Start with the <a class="URL" href="../guide/tutorial/">Prudence tutorial</a>, and feel free to skip around the documentation and try things out for yourself. You’ll find it easy, fun, and powerful enough for you to create large-scale applications that take full advantage of the inherently scalable infrastructure of REST. Happy RESTing! 
</div>
<h1 class="Section">
<a class="toc" name="toc-Section-12"></a>Scaling Tips
</h1>
<div class="Unindented">
If you want your application to handle many concurrent users, then you are fighting this fact: a request will get queued in the best case or discarded in the worst case if there is no thread available to serve it.
</div>
<div class="Indented">
Two variables influence this: 1) your total number of threads and 2) the time it takes each thread to process a request. Increasing the number of threads is straightforward: you keep adding more and more machines behind load balancers. The only challenge in this respect is financial. On the other hand, the time per request has little to do with your computer power. In fact, for various reasons it can grow longer as you keep adding threads. Minimizing the time per request is a design challenge.
</div>
<div class="Indented">
Your design objective is to increase concurrency, not necessarily performance. Optimizing for concurrency means breaking up tasks to as many pieces as possible, and possibly even breaking requests into smaller pieces. We’ll cover numerous strategies here.
</div>
<div class="Indented">
Meanwhile, feel free to frame these mantras on your wall:
</div>
<blockquote class="Quote">
‘‘Requests are hot potatoes: Pass them on!’’
</blockquote>
<blockquote class="Quote">
‘‘It’s better to have many short requests than one long one.’’
</blockquote>
<div class="Unindented">
And a favorite:
</div>
<blockquote class="Quote">
‘‘Performance does not equal scalability. Performance does not equal scalability. Performance does not equal scalability.’’
</blockquote>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-39"></a>Caching
</h2>
<div class="Unindented">
Retrieving from a cache can be orders of magnitude faster than dynamically processing a request. It’s your most powerful tool for increasing concurrency.
</div>
<div class="Indented">
Caching, however, is only effective is there’s something in the cache. It’s pointless to cache fragments that appear only to one user on only one page that they won’t return to. On the other hand, there may very well be fragments on the page that will recur often. If you design your page carefully to allow for fragmentation, you will reap the benefits of fine-grained caching. Remember, though, that the outermost fragment’s expiration defines the expiration of the included fragments. It’s thus good practice to define no caching on the page itself, and only to cache fragments.
</div>
<div class="Indented">
In your plan for fine-grained caching, take special care to isolate those fragments that cannot be cached, and cache everything around them.
</div>
<div class="Indented">
Make sure to change Prudence’s cacheKey to fit the lowest common denominator: you want as many possible requests to use the already-cached data, rather than generating new data. Note that, by default, Prudence includes the request URI in the cacheKey. Fragments, though, may very well appear identically in many different URIs. You would thus not want the URI as part of their cacheKey.
</div>
<div class="Indented">
Cache aggressively, but also take cache validation seriously. Make good use of Prudence’s cacheGroups to allow you to invalidate portions of the cache that should be updated as data changes. Note, though, that every time you invalidate you will lose caching benefits. If possible, make sure that your cacheGroups don’t include too many pages. Invalidate only those entries that really need to be invalidated.
</div>
<div class="Indented">
(It’s sad that many popular web sites do cache validation so poorly. Users have come to expect that sometimes they see wrong, outdated data on a page, sometimes mixed with up-to-date data. The problem is usually solved within minutes, or after a few browser refreshes, but please do strive for a better user experience in your web site!)
</div>
<div class="Indented">
If you’re using a deferrable task handler, you might want to invalidate cache groups when tasks are done. Consider creating a special internal API that lets the task handler call back to your application to do this.
</div>
<div class="Indented">
How long should you cache? As long as the user can bear! In a perfect world, of limitless computing resources, all pages would always be generated freshly per request. In a great many cases, however, there is no harm at all if users see some data that’s a few hours or a few days old.
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-40"></a>Necessary Tasks
</h2>
<div class="Unindented">
<i>The user can’t continue without the task being resolved.</i>
</div>
<div class="Indented">
If the necessary task is deterministically fast, you can do all processing in the request iself.
</div>
<div class="Indented">
If not, you should queue the task on a handling service and return a ‘‘please wait’’ page to the user. It woule be nice to add a progress bar or some other kind of estimation of how long it would take for the task to be done. The client will poll until the task status is marked ‘‘done,’’ after which they will be redirected somewhere else. Each polling request sent by the client could likely be processed very quickly, so this this strategy effectively breaks the task into many small requests (‘‘It’s better to have many short requests than one long one’’).
</div>
<div class="Indented">
Implementing a handling service is by no means trivial. It adds a new component to your architecture, one that also has to be made to scale. One can also argue that it adversely affects user experience by adding overhead, delaying the time it takes for the tast to complete. The bottom line, though, is you’re vastly increasing concurrency and your ability to scale. And, you’re actually improving the user experience: they would get a feedback on what’s going on rather than having their browsers spin, waiting for their requests to complete.
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-41"></a>Deferrable Tasks
</h2>
<div class="Unindented">
<i>It’s OK if the task occurs later.</i>
</div>
<div class="Indented">
As with necessary tasks, you can queue these with a task handling service, but it’s much simpler because you don’t have to keep track of status or display it to the user. This allows you to use a simpler---and more scalable---task handling service.
</div>
<div class="Indented">
Deferring tasks does present a challenge to the user experience: What do you do if the task fails, and the user needs to know about it? One solution can be to send a warning email or other kind of message to the user. Another solution could be to have your client constantly poll in the background (via ‘‘AJAX’’) to see if there are any error messages, which in turn might require you to keep a queue of such error messages per user.
</div>
<div class="Indented">
Before you decide on deferring a task, think carefully of the user experience: for example, users might be constantly refreshing a web page waiting to see the results of their operation. Perhaps the task you thought is deferrable should actually be considered necessary?
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-42"></a>Request Fragmentation
</h2>
<div class="Unindented">
The method suggested above, of having the client poll until a task is completed, lets you break up a task into multiple requests and increase concurrency. In some cases, it’s also possible to be break an individual request into pieces. Thus, while you’re doing processing, you can free the thread to handle other requests. When you’re ready to deliver content, you signal it, and then next available thread takes care of sending your response to the client.
</div>
<div class="Indented">
This is also called ‘‘chunking,’’ ‘‘asynchronous’’ request handling and, at a lower level, ‘‘non-blocking I/O.’’ For web services that deliver heavy content, such as images, video, audio, it’s absolutely necessary. Without it, a single user could tie up a thread for minutes, if not hours. You would still get degraded performance if you have more concurrent users than you have threads, but at least degradation will be shared among users. Without fragmentation, each user will tie up a thread, and if you’re saturated it means that more users won’t even be able to access your service.
</div>
<div class="Indented">
Even for HTML web pages, which easily fit in a single ‘‘chunk,’’ fragmentation can be a good tactic for increasing concurrency. For example, if you need to fetch data from a backend with non-deterministic response time, it’s best to free your thread until you actually have content available for the response.
</div>
<div class="Indented">
Prudence’s streaming mode allows for this: conversation.stream and conversation.yield let you break up your response. Note that your local variables aren’t kept between calls, but in some cases you won’t have to keep them, because different parts of the response do entirely different things. If you do need to pass state to the next segment, then you can use conversation.locals.
</div>
<div class="Indented">
Using conversation.locals requires considerable responsibility. You need to make sure that objects stored there do not hold up any other part of the stack. For example, you might be tempted to put a database connection there so that you can reuse it in the next segment, but this will offer poor concurrency. Though you’re releasing the web thread by calling conversation.yield, the database connection is not released. You’ll probably want to maintain a database connection pool, so that you can release it before calling yield, and get a new connection afterwards. As you can see, efficient use of conversation.locals requires careful planning, and possibly auxiliary systems.
</div>
<div class="Indented">
It’s not a good idea to do this for every page. While it’s better to have many short requests instead of one long one, it’s obviously better to have one short request rather than many short ones. Which web requests are good candidates for fragmentation?
</div>
<ol>

<li>
Requests that do a few independent operations (meaning that you won’t have to use conversation.locals to coordinate between them).
</li>
<li>
Requests that must access services with non-deterministic response times.
</li>
</ol>
<div class="Unindented">
And, even for #2, if the service can take a <i>very</i> long time to respond, consider that it might be better to queue the task on a task handler and give proper feedback to the user.
</div>
<div class="Indented">
And so, after this lengthy discussion, it turns out that request fragmentation is not such a useful strategy for increasing concurrency. Caching is definitely far more important.
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-43"></a>Data Backends
</h2>
<div class="Unindented">
You can keeping adding more nodes behind a load balancer insofar as each request does not have to access shared state. Useful web applications, however, are likely data-driven.
</div>
<div class="Indented">
If the challenge in handling web requests is cutting down the length of request, then that of relational data backends is the struggle against degraded performance as you add new nodes to your database cluster. These nodes have to be synchronized with each other, and that synchronization overhead increases exponentially. There’s a definite point of diminishing returns.
</div>
<div class="Indented">
Fortunately, there are perfectly workable strategies for scaling data backends.
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-13"></a>Graph Databases
</h3>
<div class="Unindented">
If your relational data structure contains a lot of many-to-many relationships and ‘‘generic’’ relationships forced into a relational model, then consider using a graph database instead. Not only will your queries be faster, but also the database structure will allow for more efficient replication, and thus scalability. The improvement over relational databases can be dramatic.
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-14"></a>Document Databases
</h3>
<div class="Unindented">
If your data contains mostly ‘‘documents’’---self-contained records with few relationships to other documents---then consider a document database.
</div>
<div class="Indented">
Document databases allow for straightforward distribution and very fine-grained replication, requiring considerably less overhead than relational databases. They are very scalable.
</div>
<div class="Indented">
The cost of this scalability is that you cannot do relational queries of your data. Instead, you’ll be using distributed map/reduce, or rely on an external indexing service. These are powerful tools, but they do not match relational queries in speed and power.
</div>
<div class="Indented">
Document databases are not recommended for all web applications. Many useful applications cannot be reduced to sets of lightly interconnected ‘‘documents’’ without giving up a lot of useful functionality.
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-15"></a>Best of Both Worlds
</h3>
<div class="Unindented">
Of course, consider that it’s very possible to use both SQL and ‘‘NoSQL’’ databases together for different parts of your application.
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-16"></a>Powering Up
</h3>
<div class="Unindented">
The database is one place where high-performance hardware can help. Ten expensive, powerful machines might be equal in total power to forty cheap machines, but they require a quarter of the synchronization overhead, giving you more elbow room to scale up.
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-17"></a>Partitioning
</h3>
<div class="Unindented">
Partitioning is as useful to relational database scaling as caching is to web request scaling.
</div>
<div class="Indented">
Rather than having one big cluster of identical databases, you will have several smaller clusters of different, independent databases. This lets you add nodes to each cluster without spreading synchronization overhead everywhere. The more partitions you can create, the better you’ll be able to scale.
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-50"></a>Reads vs. Writes
</div>
<div class="Unindented">
This simple partitioning scheme greatly reduces synchronization overhead. Read-only servers will never send data to the writable servers. Also, knowing that they don’t have to handle writes means you can optimize their configurations for aggressive caching.
</div>
<div class="Indented">
(In fact, some database synchronization systems will only let you create this kind of cluster, providing you with one ‘‘master’’ writable node and several read-only ‘‘slaves.’’ They force you to partition!)
</div>
<div class="Indented">
Another nice thing about read/write partitioning is that you can easily add it to all the other strategies. Any cluster can thus be divided into two.
</div>
<div class="Indented">
Of course, for web services that are heavily balanced towards writes, this is not an effective strategy. For example, if you are implementing an auditing service that is constantly being bombarded by incoming data, but is only queried once in a while, then an extra read-only node won’t help you scale.
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-51"></a>By Feature
</div>
<div class="Unindented">
The most obvious and effective partitioning scheme is by feature. Your site might offer different kinds of services that are functionally independent of each other, even though they are displayed to users as united. Behind the scenes, each feature uses a different set of tables. The rule of thumb is trivial: if you can put the tables in separate databases, then you can put them these databases in separate clusters.
</div>
<div class="Indented">
One concern in feature-based partitioning is that there are a few tables that still need to be shared. For example, even though the features are separate, they all depend on user settings that are stored in one table.
</div>
<div class="Indented">
The good news is that it can be cheap to synchronize just this one table between all clusters. Especially if this table doesn’t change often---how often do you get new users signing up for your service?---then synchronization overhead will be minimal.
</div>
<div class="Indented">
If your database system doesn’t let you synchronize individual tables, then you can do it in your code by writing to all clusters at the same time.
</div>
<div class="Indented">
Partitioning by feature is terrific in that it lets you partition other parts of the stack, too. For example, you can also use a different set of web servers for each feature.
</div>
<div class="Indented">
Also consider that some features might be candidates for using a ‘‘NoSQL’’ database. Choose the best backend for each feature.
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-52"></a>By Section
</div>
<div class="Unindented">
Another kind of partitioning is sometimes called ‘‘sharding.’’ It involves splitting up tables into sections that can be placed in different databases. Some databases support sharding as part of their synchronization strategy, but you can also implement it in your code. The great thing about sharding is that it lets you create as many shards (and clusters) as you want. It’s the key to the truly large scale.
</div>
<div class="Indented">
Unfortunately, like partitioning by feature, sharding is not always possible. You need to also shard all related tables, so that queries can be self-contained within each shard. It’s thus most appropriate for one-to-many data hierarchies. For example, if your application is a blog that supports comments, then you put some blogs and their comments on one shard, and others in another shard. However, if, say, you have a feature where blog posts can refer to other arbitrary blog posts, then querying for those would have to cross shard boundaries.
</div>
<div class="Indented">
The best way to see where sharding is possible is to draw a diagram of your table relationships. Places in the diagram which look like individual trees---trunks spreading out into branches and twigs---are good candidates for sharding.
</div>
<div class="Indented">
How to decide which data goes in which shard?
</div>
<div class="Indented">
Sometimes the best strategy is arbitrary. For example, put all the even-numbered IDs in one shard, and the odd-numbered ones in another. This allows for straightforward growth because you can just switch it to division by three if you want three shards.
</div>
<div class="Indented">
Another strategy might seem obvious: If you’re running a site which shows different sets of data to different users, then why not implement it as essentially separate sites? For example, a social networking site strictly organized around individual cities could have separate database clusters per city.
</div>
<div class="Indented">
A ‘‘region’’ can be geographical, but also topical. For example, a site hosting dance-related discussion forums might have one cluster for ballet and one for tango. A ‘‘region’’ can also refer to user types. For example, your social networking site could be partitioned according to age groups.
</div>
<div class="Indented">
The only limitation is queries. You can still let users access profiles in other regions, but cross-regional relational queries won’t be possible. Depending on what your application does, this could be a reasonable solution.
</div>
<div class="Indented">
A great side-benefit to geographical partitioning is that you can host your servers at data centers within the geographical location, leading to better user experiences. Regional partitioning is useful even for ‘‘NoSQL’’ databases.
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-18"></a>Coding Tips
</h3>
<div class="Unindented">
If you organize your code well, it would be very easy to implement partitioning. You simply assign different database operations to use different connection pools. If it’s by feature, then you can hardcode it for those features. If it’s sharding, then you add a switch before each operation telling it which connection pool to use.
</div>
<div class="Indented">
Unfortunately, some programming practices make such an effective, clean organization difficult.
</div>
<div class="Indented">
Some developers prefer to use ORMs rather than access the database directly. Unfortunately, many ORMs do not easily allow for partitioning, either because they support only a single database connection pool, or because they don’t allow your objects to be easily shared between connections.
</div>
<div class="Indented">
For example, your logic might require you to retrieve an ‘‘object’’ from the database, and only then decide if you need to alter it or not. If you’re doing read/write partitioning, then you obviously want to read from the read partition. Some ORMs, though, have the object tied so strongly to an internal connection object that you can’t trivially read it from one connection and save it into another. You’d either have to read the object initially from the write partition, minimizing the usefulness of read/write partitioning, or re-read it from the write partition when you realize you need to alter it, causing unnecessary overhead.
</div>
<blockquote class="Quote">
If you want to use an ORM, make sure it lets you move objects between connections.
</blockquote>
<div class="Unindented">
Object oriented design is also problematic in a more general sense. The first principle of object orientation is ‘‘encapsulation,’’ putting your code and data structure in one place: the class. This might make sense for business logic, but, for the purposes of partitioning, you really don’t want the data access code to be spread out among dozens of classes in your application. You want it all in one place, preferably even one source code file, so that you can apply partitioning strategies easily.
</div>
<div class="Indented">
In fact, organizing code together by mechanism, rather than by ‘‘class,’’ will let you apply all kinds of large-scale refactorizations more easily, especially if you manage to decouple your data structures from any library-specific data structures.
</div>
<div class="Indented">
If you must use object orientation, consider separating only the data layer from the class hierarchy. You’ll save yourself from a lot of trouble later on as you find yourself having to scale up. For data-driven web development, you are better off not being too object oriented.
</div>
<h1 class="Section">
<a class="toc" name="toc-Section-13"></a>Under the Hood
</h1>
<div class="Unindented">
Prudence brings together many open source libraries, some of which were designed specifically for Prudence.
</div>
<div class="Indented">
Consider this as Prudence’s ‘‘acknowledgments’’ page. Hundreds of people have worked on these libraries, and we’re grateful to all of them for sharing their hard work, for embracing open source licensing, and for adhering to design principles that allow reuse of their work in other projects, such as Prudence.
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-44"></a>Restlet
</h2>
<div class="Unindented">
Prudence went through many transformations before aligning itself strongly with Restlet. First, we experimented with <a class="URL" href="https://facelets.dev.java.net/">Facelets</a>, but ended up giving up on <a class="URL" href="http://java.sun.com/javaee/javaserverfaces/">JSF</a>, its complex lifecycle, and on the promise of component-based web development in general. Then, we designed REST architectures using servlets and <a class="URL" href="http://threecrickets.com/succinct/">Succinct</a> templates, but found it awkward to force servlets into a REST architecture. Discovering <a class="URL" href="http://www.restlet.org/">Restlet</a> was a breath of fresh air.
</div>
<div class="Indented">
Restlet’s super-powers are three:
</div>
<ol>

<li>
Clean abstraction of HTTP requests, responses and headers over best-of-breed engines, such as <a class="URL" href="https://grizzly.dev.java.net/">Grizzly</a>, <a class="URL" href="http://jetty.codehaus.org/jetty/">Jetty</a> and <a class="URL" href="http://www.jboss.org/netty">Netty</a>. Automatically gain the scalable advantages of non-blocking I/O and even asynchronous request handling (which will be even better supported in Restlet 2.1). Restlet transparently handles conditional requests, content negotiation, and other complicated HTTP labor.
</li>
<li>
Powerful URI routing and manipulation. Expose your service to users and APIs with elegance and coherence. Make sure the URI reaches its destination, with support for virtual hosting, rewriting, templating, and other useful real-world features. Restlet is truly the Swiss army knife of URIs!
</li>
<li>
Straightforward data representation and consumption through a diverse set of extensions. Expose your data using any standard format, and even convert it on-the-fly. Easily parse data received from clients.
</li>
</ol>
<div class="Unindented">
Restlet is a great library, with a great ecosystem of extensions. In embracing it, though, we missed some of the advantages of having a servlet container: easy deployment and configuration, centralized logging, etc. We also missed having JSP at our fingertips to quickly push out dynamic HTML.
</div>
<div class="Indented">
Prudence is meant to fill in these gaps. 
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-45"></a>The JVM
</h2>
<div class="Unindented">
How wonderful that the best-performing, most robust and most widely ported virtual machine is now open source? How wonderful that you can use it with JavaScript, Python, Ruby, Clojure, PHP and others languages?
</div>
<div class="Indented">
We strongly recommend the JVM for enterprise and internet applications, even if you’re not particularly fond of Java (the programming language). 
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-46"></a>Jython, JRuby, Clojure, Rhino, Quercus, Groovy
</h2>
<div class="Unindented">
Prudence would hardly be as exciting if you had to use Java.
</div>
<div class="Indented">
These open source language engines have allowed us to extend the power of Prudence, REST and the JVM to languages outside of Java. Some of these engines are huge, complex projects, and are in fact the biggest libraries included in Prudence. We strongly recommend you join in the communities surrounding the language engines corresponding to your chosen Prudence flavor.
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-47"></a>Scripturian
</h2>
<div class="Unindented">
To make Prudence applications easy to deploy, they could not be traditional Java. The cycle of compilation and packaging is unnecessarily cumbersome. Though we could have implemented something like the on-the-fly Java compilation done in JSP, but we felt that, if that’s the route to go, many choices open up besides Java, and that these languages are more relevant to Prudence’s goals.
</div>
<div class="Indented">
There are many terrific JVM-based languages out there. Unfortunately, we found that integrating these languages into Prudence was anything but trivial. Each implementation had its own idea of what was acceptable support for embedding. We tried to standardize on <a class="URL" href="http://java.sun.com/developer/technicalArticles/J2SE/Desktop/scripting/">JSR-223 (the Java scripting standard)</a>, but found that adherence to the spec was inconsistent. We hacked and hacked and hacked. We even submitted patches to fix broken implementations of various languages. All in all, we probably spent more time on this than on any other aspect of Prudence.
</div>
<div class="Indented">
Since we think software other than Prudence can make use of our hard-won gains, we’ve abstracted and separated our language integration code as the <a class="URL" href="http://threecrickets.com/scripturian/">Scripturian</a> library. 
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-48"></a>Succinct
</h2>
<div class="Unindented">
<a class="URL" href="http://threecrickets.com/succinct/">Succinct</a>also started as a part of Prudence (one of its earliest components) that branched out into an independent library. We created it because we wanted straightforward, scalable templating built in to Prudence, and were unsatisfied by other open source offerings. We think you’ll like it. 
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-49"></a>Jygments
</h2>
<div class="Unindented">
Yet another Prudence side-project!
</div>
<div class="Indented">
For Prudence’s debug mode, we wanted good syntax highlighting for viewing source code. We found nothing adequate enough in the Java world, though we fell in love with Pygments. For a while, we ran Pygments in Prudence via Jython, but found it too heavy for this particular use case. Thus, <a class="URL" href="http://jygments.tigris.org/">Jygments</a> was born as a port of Pygments to Java. 
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-50"></a>H2
</h2>
<div class="Unindented">
We’re great fans of this lean and mean database engine! It has allowed us to distribute Prudence with a fully-functioning data-drive demo application, without any external dependencies. We’re proud to introduce <a class="URL" href="http://www.h2database.com/">H2</a>, through Prudence, to more people, and we believe you’ll find it fast enough, reliable enough, and flexible enough for many production environments. 
</div>
<h1 class="Section">
<a class="toc" name="toc-Section-14"></a>FAQ
</h1>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-51"></a>REST
</h2>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-19"></a>Why are plural URL forms for aggregate resources (/animal/cats/) preferred over singular forms (/animal/cat/)?
</h3>
<div class="Unindented">
You’ll see RESTful implementations that use either convention. The advantage of using the singular form is that you have less addresses, and what some people would call a more elegant scheme:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">/animal/cat/12 -&gt; Just one cat
/animal/cat/ -&gt; All cats
</code>
</div>
</div>
</div>
<div class="Indented">
Why add another URL when a single one is enough to do the work?  One reason is that you can help the client avoid potential errors. For example, the client probably uses a variable to hold the ID of the cat and then constructs the URL dynamically. But, what if the client forgets to check for null IDs? It might then construct a URL in the form "/animal/cat//" which would then successfully access <i>all</i> cats. This can cause unintended consequences and be difficult to debug. If, however, we used this scheme:
</div>
<div class="Indented">

<div class="float">

<div class="listing">
<code class="listing">/animal/cat/12 -&gt; Just one cat
/animal/cats/ -&gt; All cats
</code>
</div>
</div>
</div>
<div class="Indented">
...then the form ‘‘/animal/cat//’’ would route to our singular cat resource, which would indeed not find the cat and return the expected, debuggable 404 error. From this example, we can extract a good rule of thumb: clearly separate URLs at their base by usage, so that mistakes cannot happen. More addresses means more debuggability. 
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-52"></a>Languages
</h2>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-20"></a>Why mix languages? 
</h3>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-21"></a>What are ‘‘in-flow’’ scriptlets? 
</h3>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-22"></a>Can different languages share state? 
</h3>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-23"></a>Can languages call each other’s functions? 
</h3>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-53"></a>Concurrency
</h2>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-24"></a>Should I be worried? 
</h3>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-25"></a>How to make my code thread safe? 
</h3>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-54"></a>Performance
</h2>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-26"></a>Which Prudence flavor performs best? 
</h3>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-27"></a>How well does Prudence perform? How well does it scale?
</h3>
<div class="Unindented">
First, recognize that there are two common uses for the term ‘‘scale.’’ REST is often referred to as an inherently scalable architecture, but that has more to do with project management than technical performance. This difference is address in the &lt;a href="../rest/"&gt;Making the Case for REST&lt;/a&gt;. 
</div>
<div class="Indented">
From the perspective of the ability to respond to user requests, there are three aspects to consider: 
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-53"></a>1. Serving HTTP
</div>
<div class="Unindented">
Prudence comes with &lt;a href="https://grizzly.dev.java.net/"&gt;Grizzly&lt;/a&gt;, an HTTP server based on the JVM’s non-blocking I/O API. Grizzly handles concurrent HTTP requests very well, and serves static files at scales comparable to popular HTTP servers. See the &lt;a href="../guide/tutorial/"&gt;tutorial&lt;/a&gt; for more information. 
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-54"></a>2. Generating HTML
</div>
<div class="Unindented">
Prudence supports two modes for generating HTML (and other textual formats), each with its own performance characteristics:
</div>
<div class="Subparagraph">
Caching mode:
</div>
<div class="Unindented">
First, the entire document is run, with its output sent into a buffer. This buffer is then cached, and <i>only then</i> sent to the client. This is the default mode and recommended for most documents. Scriptlets can be used to control the duration of the document’s individual cache. 
</div>
<div class="Subparagraph">
Streaming mode:
</div>
<div class="Unindented">
Output is sent to the client <i>while</i> the document runs. This is recommended for documents that need to output a very large amount of text, which might take a long time, or that might otherwise encounter slow-downs while running. In either case, you want the client to receive ongoing output. The output of the document is not cached.  Scriptlets can switch between modes according to changing circumstances. For example, to increase caching duration during heavy loads, to decrease it during periods where data changes often, or to stream in the case of an expected large output. See the &lt;a href="../guide/tutorial/"&gt;tutorial&lt;/a&gt; for more information. 
</div>
<div class="Paragraph">
<a class="toc" name="toc-Paragraph-55"></a>3. Running code
</div>
<div class="Unindented">
There may be a delay when starting up a specific language engine in Prudence for the first time in an application, as it loads and initializes itself. Then, there may be a delay when accessing a dynamic web page or resource for the first time, or after it has been changed, as it might require compilation. Once it’s up and running, though, your code performs and scale very well---as well as you’ve written it. You need to understand concurrency and make sure you make good choices to handle coordination between threads accessing the same data. If all is good, your code will actually perform better throughout the life of the application. The JVM learns and adapts as it runs, and performance can improve the more the application is used.
</div>
<div class="Indented">
If you are performing CPU-intensive or time-sensitive tasks, then it’s best to profile these code segments precisely. Exact performance characteristics depend on the language and engine used. The <a class="URL" href="http://shootout.alioth.debian.org/">Bechmarks Game</a> can give you some comparisons of different language engines running high-computation programs. In any case, if you have a piece of intensive code that really needs to perform well, it’s probably best to write it in Java and access it from the your language. You can even write it in C or assembly, and have it linked to Java via JNI.   If you’re not doing intensive computation, then don’t worry too much about your language being "slow." It’s been shown that for the vast majority of web applications, the performance of the web programming language is rarely the bottleneck. The deciding factors are the usually performance of the backend data-driving technologies and architectures.  
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-55"></a>Scalability
</h2>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-28"></a>Do you have any tips?
</h3>
<div class="Unindented">
Yes. :)
</div>
<h2 class="Subsection">
<a class="toc" name="toc-Subsection-56"></a>Licensing
</h2>
<div class="Unindented">
(The author is not a lawyer. This is not a legal advice, but a personal interpretation. The wording of the license itself superceds anything written here.)
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-29"></a>Does the LGPL mean I can’t use Prudence unless my product is open sourced?
</h3>
<div class="Unindented">
The GPL family of licenses restrict your ability to <i>redistribute</i> software, not to use it. You are free to use Prudence as you please within your organization, even if you’re using it to serve public web sites (though with no warranty nor an implicit guarantee of support from Three Crickets, the copyright holder).
</div>
<div class="Indented">
The GPL would thus only be an issue if you’re selling, or even giving away, a product that <i>would include</i> Prudence.
</div>
<div class="Indented">
Prudence uses the Lesser GPL, which has even less restrictions on redistribution than the regular GPL. As long as you do not alter Prudence in any way, you can include Prudence in any product, free or non-free. (Actually, Prudence uses version 3 of the Lesser GPL, which requires your product, even if it’s not free software, to at least not restrict users’ ownership of data via schemes such as DRM if you want to include Prudence in its distribution.)
</div>
<div class="Indented">
Even if your product does not qualify for including Prudence in it, you always have the option of distributing your product without Prudence, and instructing your customers to download and install Prudence on their own.
</div>
<div class="Indented">
Three Crickets, the original developers of Prudence, are not trying to force you to purchase it. Instead, they hope to encourage you 1) to pay Three Crickets for consultation, support and development services for Prudence, and 2) to release your own product as free software, thereby truly sharing your innovation with all of society.
</div>
<div class="Indented">
We understand that in some cases open sourcing your product is impossible. As a last resort, we offer you a commercial license. Please contact us for details.
</div>
<h3 class="Subsubsection">
<a class="toc" name="toc-Subsubsection-30"></a>Why the LGPL and not the GPL?
</h3>
<div class="Unindented">
The Lesser GPL used to be called the ‘‘Library GPL,’’ and was originally drafted for glibc. It represents a certain admission of defeat: there are so many alternatives to our library out there, that you might not consider using our library under GPL.
</div>
<div class="Indented">
In the case of Linux, the GPL has done a wonderful job in convincing vendors to open source their code in order to ship their products with Linux inside. It just doesn’t seem likely that they would do the same for Prudence.
</div>
<div class="Indented">
Note that the LGPL version 3 has a clause allowing you to ‘‘upgrade’’ Prudence to the full GPL for inclusion in your GPL-ed product. This is a terrific feature, and another reason to love this excellent license.
</div>

<hr/>
<p>Copyright (C) 2010 Tal Liron</p>
</div>
</body>
</html>
